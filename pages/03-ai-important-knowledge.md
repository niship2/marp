---
marp: true
theme: default
paginate: true
backgroundColor: #fff
backgroundImage: url('https://marp.app/assets/hero-background.svg')
style: |
  section {
    font-size: 1.2em;
  }
  h1 {
    font-size: 2.5em;
  }
  h2 {
    font-size: 2em;
  }
  h3 {
    font-size: 1.5em;
  }
  h4 {
    font-size: 1.3em;
  }
  p, li {
    font-size: 1.1em;
  }
  table {
    font-size: 1em;
  }
  code {
    font-size: 0.9em;
  }
---

## 3. コンテキストエンジニアリングの重要性

---

## 3-1. プロンプトの先へ：コンテキストの重要性

#### プロンプトエンジニアリングの限界

**従来のプロンプト設計の問題点**

- **単発的な指示**: 個別の質問に対する一時的な回答
- **文脈の欠如**: 背景情報や継続的な関係性の不足
- **一貫性の欠如**: 複数の質問間での整合性の欠如
- **学習効果の欠如**: 過去のやり取りからの学習不足

---

## 3-1. プロンプトの先へ：コンテキストの重要性（続き 1）

#### コンテキストエンジニアリングの必要性

- **全体的な設計**: AI との対話全体を体系的に設計
- **継続的な関係**: 長期的な対話関係の構築
- **文脈の蓄積**: 過去のやり取りの効果的な活用
- **適応的改善**: 対話を通じた継続的な最適化

---

## 3-1. プロンプトの先へ：コンテキストの重要性（続き 2）

#### コンテキストエンジニアリングとは

**定義**

```
コンテキストエンジニアリングとは、AIとの対話において、
効果的な文脈（コンテキスト）を設計・構築し、
期待する出力を得るための包括的なアプローチである。

```

[Context Engineering](https://blog.langchain.com/context-engineering-for-agents/)

---

![Context Engineering](../img/img001.png){width=50}

---

## 3-1. プロンプトの先へ：コンテキストの重要性（続き 3）

#### プロンプトエンジニアリングとの違い

| 項目     | プロンプトエンジニアリング | コンテキストエンジニアリング |
| -------- | -------------------------- | ---------------------------- |
| **範囲** | 個別の指示設計             | 対話全体の設計               |
| **期間** | 短期的・一時的             | 長期的・継続的               |
| **目的** | 特定の回答獲得             | 全体的な対話品質向上         |
| **手法** | 指示の最適化               | 文脈・環境・関係性の設計     |

---

## 3-1. プロンプトの先へ：コンテキストの重要性（続き 4）

#### コンテキストエンジニアリングの利点

- **一貫性の向上**: 複数の質問間での整合性確保
- **効率性の向上**: 文脈の再利用による時間短縮
- **品質の向上**: 背景情報の活用による精度向上
- **学習効果**: 継続的な改善と最適化

---

## 3-2. コンテキストエンジニアリングの基本概念

#### コンテキストの構成要素

**1. 役割設定（Role Definition）**

```
AIの専門性・能力・制約を明確に定義
例：「あなたは特許調査の専門家で、20年の実務経験があります」
```

---

## 3-2. コンテキストエンジニアリングの基本概念（続き 1）

#### コンテキストの構成要素（続き）

**2. 背景情報（Background Information）**

```
対話に必要な前提知識・状況・制約を提供
例：「現在、AI技術分野の先行技術調査を実施中」
```

**3. 対話履歴（Conversation History）**

```
過去のやり取りの記録と活用
例：「先ほどの検索結果を踏まえて、次の分析を実施」
```

---

## 3-2. コンテキストエンジニアリングの基本概念（続き 2）

#### コンテキストの構成要素（続き 2）

**4. 環境設定（Environment Setup）**

```
利用可能なツール・データ・制約の設定
例：「特許データベースへのアクセス権限があります」
```

---

## 3-2. コンテキストエンジニアリングの基本概念（続き 3）

#### コンテキスト設計の基本原則

**CONTEXT 原則**

- **C**omprehensive（包括的）: 必要な情報を網羅
- **O**rganized（整理された）: 論理的な構造化
- **N**atural（自然な）: 人間らしい対話の流れ
- **T**argeted（目的指向）: 明確な目標設定
- **E**volving（進化する）: 継続的な改善
- **X**plicit（明示的）: 曖昧さの排除
- **T**imely（適時性）: タイミングの最適化

---

## 3-2. コンテキストエンジニアリングの基本概念（続き 4）

#### コンテキスト設計の実践ポイント

**設計の流れ**

1. **目的の明確化**: 何を達成したいかを明確にする
2. **情報の整理**: 必要な情報を体系的に整理する
3. **構造の設計**: 論理的な構造を設計する
4. **実装とテスト**: 実際に使用して効果を確認する
5. **改善と最適化**: 継続的に改善していく

---

## 3-2. コンテキストエンジニアリングの基本概念（続き 5）

#### コンテキスト設計の実践ポイント（続き）

**成功の鍵**

- **段階的な構築**: 一度にすべてを構築せず、段階的に
- **継続的な改善**: 使用結果をフィードバックとして活用
- **柔軟性の確保**: 状況に応じて調整可能な設計
- **実用性の重視**: 実際の業務で使いやすい設計

---

## 3-3. 知財業務でのコンテキストエンジニアリング実践

#### 特許調査におけるコンテキスト設計

**基本設計例**

<role>
あなたは特許調査の専門家で、20年の実務経験があります。
特にAI技術分野での調査に精通しており、新規性・進歩性の評価を得意としています。
</role>

---

## 3-3. 知財業務でのコンテキストエンジニアリング実践（続き 1）

#### 特許調査におけるコンテキスト設計（続き）

<context>
現在、AI技術分野の先行技術調査を実施中です。
調査対象は2020年以降の特許文献で、特にリアルタイム処理技術に注目しています。
</context>

<environment>
利用可能なツール：
- 特許データベース（J-PlatPat、USPTO）
- 技術文献データベース
- 分析ツール（Excel、Python）
</environment>

---

## 3-3. 知財業務でのコンテキストエンジニアリング実践（続き 2）

#### 特許調査におけるコンテキスト設計（続き 2）

<conversation_style>
専門的かつ実用的な分析を提供し、具体的な根拠を示してください。
技術的詳細と法的観点の両方を考慮した回答をお願いします。
</conversation_style>

<expertise>
- 特許法の深い理解
- 技術動向の把握
- 検索戦略の設計
- 分析手法の選択
</expertise>

---

## 3-3. 知財業務でのコンテキストエンジニアリング実践（続き 3）

#### 明細書作成におけるコンテキスト設計

**基本設計例**

<role>
あなたは特許明細書作成の専門家で、25年の実務経験があります。
特許庁の要件に完全準拠した明細書作成と、法的妥当性の確保を得意としています。
</role>

---

## 3-3. 知財業務でのコンテキストエンジニアリング実践（続き 4）

#### 明細書作成におけるコンテキスト設計（続き）

<context>
新規発明の特許出願準備中です。
先行技術との関係を明確にし、発明の新規性・進歩性を適切に説明する必要があります。
</context>

<environment>
利用可能な情報：
- 発明の詳細仕様
- 先行技術文献
- 特許庁の審査基準
- 関連する技術動向
</environment>

---

## 3-3. 知財業務でのコンテキストエンジニアリング実践（続き 5）

#### 明細書作成におけるコンテキスト設計（続き 2）

<conversation_style>
法的に正確で、技術的に詳細な明細書作成を支援します。
特許庁の要件を満たし、実用的な提案を提供します。
</conversation_style>

<expertise>
- 特許法の深い理解
- 技術的詳細の把握
- 明細書作成の実務
- 審査対応の経験
</expertise>

---

## 3-4. コンテキスト設計の実践テクニック

#### 段階的なコンテキスト構築

**Step 1: 基本設定の確立**

```
1. 役割の明確化
   - AIの専門性・能力の定義
   - 期待される行動パターンの設定

2. 背景情報の整理
   - 業務の目的・状況の説明
   - 制約条件の明示

3. 環境設定の構築
   - 利用可能なツール・データの定義
   - 制限事項の明確化

```

---

## 3-4. コンテキスト設計の実践テクニック（続き）

#### 段階的なコンテキスト構築（続き）

**Step 2: 対話履歴の活用**

```

1. 過去のやり取りの記録
   - 質問と回答の保存
   - 効果的なパターンの特定

2. 文脈の継承
   - 前回の結果を踏まえた質問
   - 一貫性のある回答の確保

3. 学習効果の活用
   - 成功事例の蓄積
   - 改善点の特定

```

---

## 3-4. コンテキスト設計の実践テクニック（続き 3）

#### コンテキストの動的調整

**状況に応じた調整**

- **業務フェーズ**: 調査 → 分析 → 作成 → 評価の各段階
- **重要度**: 高重要度案件と通常案件の使い分け
- **緊急度**: 緊急案件と通常案件の対応方法
- **専門性**: 技術分野による専門性の調整
  **継続的な最適化**

- **効果測定**: 定期的な効果評価の実施
- **フィードバック収集**: 実際の使用感の収集
- **改善実施**: 効果的な改善の実施
- **ベストプラクティス化**: 成功パターンの標準化

#### コンテキスト設計のチェックリスト

**設計時の確認項目**

□ 役割が明確に定義されているか
□ 背景情報が十分に提供されているか
□ 環境設定が適切に行われているか
□ 対話スタイルが統一されているか

---

## 3-4. コンテキスト設計の実践テクニック（続き 4）

#### コンテキスト設計のチェックリスト（続き）

**設計時の確認項目（続き）**

□ 専門性が適切に設定されているか
□ 制約条件が明確になっているか
□ 継続的な改善の仕組みがあるか

---

## 3-4-1. プロンプト形式の選択：マークアップ vs マークダウン

#### プロンプト形式の使い分け

**結論：モデルやタスクの複雑さに応じて使い分けるのが最適**

LLM へのプロンプトで、マークアップ（`<tag>`のような形式）とマークダウン（`##`のような形式）、どちらを使うべきか、またモデルによって推奨があるのか？
⇒ どちらか一方が絶対的に優れているわけではなく、それぞれに得意な場面があるので使い分けを

---

## 3-4-1. プロンプト形式の選択：マークアップ vs マークダウン（続き 1）

#### マークダウン形式（## や - など）

**人間にとっての読みやすさと書きやすさが最大の特徴**

**メリット**

- **可読性が高い**: 人間が読んでも構造が分かりやすい
- **記述が容易**: `## 見出し` や `- リスト` のように、簡単かつ迅速に記述できる
- **広く対応**: ほとんどの LLM（GPT シリーズ、Gemini など）が特別な設定なしでうまく解釈できる
- **明確な階層構造**: 見出し（#, ##）を使うことで、指示の重要度やセクションの区切りをモデルに伝えやすい

---

**デメリット**

- **厳密な区別が難しい場合がある**: 例えば、複数の文書をプロンプトに含める際、「ここからここまでが文書 A」「ここからが文書 B」という境界を厳密に定義するには、マークダウンだけでは少し弱い場合あり。

---

## 3-4-1. プロンプト形式の選択：マークアップ vs マークダウン（続き 2）

#### マークダウン形式の主な利用シーン

**一般的な質問応答、文章生成、要約など**

- プロンプトの構造が比較的シンプルな場合
- 指示、コンテキスト、質問といったセクションを分かりやすく区切りたい場合

---

**プロンプト例（マークダウン）**

```markdown
## 指示

以下の文章を、小学生にもわかるように要約してください。

## 制約条件

- 3 つの箇条書きでまとめること
- 専門用語は使わないこと

## 元の文章

人工知能（AI）は、人間の知的ふるまいの一部をソフトウェアを用いて人工的に再現したものである。特に、近年の深層学習（ディープラーニング）技術の発展により、画像認識や自然言語処理の分野で著しい成果を上げている。
```

---

## 3-4-1. プロンプト形式の選択：マークアップ vs マークダウン（続き 3）

#### マークアップ形式（<tag> や </tag> など）

**XML や HTML のようにタグで囲むことで、プロンプト内の各要素の「役割」をより厳密に定義**

特に複雑な指示や、複数の異なる種類の情報を入力する際に効果を発揮

**メリット**

- **構造の厳密な定義**: `<document>`や`<instruction>`のようにタグ付けすることで、各部分の役割をモデルに明確に伝えることができる。これにより、モデルが「指示」と「コンテキスト」を混同するのを防ぐ
- **特定のモデルで推奨**: 特に Anthropic 社の Claude は、公式ドキュメントで XML タグの使用を推奨しており、複雑なタスクにおいて性能が向上することが示されている
- **処理の自動化と相性が良い**: プログラムでプロンプトを生成・解析する際に、タグを目印に処理をしやすい

**デメリット**

- **記述が冗長**: タグの開始と終了を記述する必要があり、手書きするには少し手間
- **可読性の低下**: タグが増えると、人間にとっては少し読みにくくなる

---

## 3-4-1. プロンプト形式の選択：マークアップ vs マークダウン（続き 4）

#### マークアップ形式の主な利用シーン

**複数の文書や例をインプットとして与え、それらを明確に区別させたい場合**

- 指示、コンテキスト、ユーザーからの質問、出力形式の指定など、プロンプトの構成要素が多岐にわたる複雑なタスク
- Anthropic 社の Claude を利用する場合

**プロンプト例（マークアップ）**

```xml
<instructions>
以下の<document>で提供される契約書を分析し、重要なポイントを抽出してください。
</instructions>

<document>
第1条（目的）
本契約は、甲と乙との間の業務委託に関する基本的事項を定めることを目的とする。
...（契約書の本文が続く）...
</document>

<output_format>
抽出したポイントは、以下のXMLタグを使用してフォーマットしてください。
<summary>
  <point>ここに1つ目のポイント</point>
  <point>ここに2つ目のポイント</point>
</summary>
</output_format>
```

---

## 3-4-1. プロンプト形式の選択：マークアップ vs マークダウン（続き 5）

#### モデルによる推奨の違い

**Anthropic (Claude シリーズ)**

マークアップ（XML タグ）を推奨しています。公式のプロンプトエンジニアリングガイドでは、複雑なプロンプトの各要素を`<example>`や`<document_to_analyze>`のようなタグで囲むことで、モデルの理解度と応答の精度が向上する例多し

**OpenAI (GPT シリーズ)**

特定の形式を強く推奨してはいませんが、プロンプトエンジニアリングのベストプラクティスとして、指示とコンテキストを区切り文字（例：`###` や `"""`）で明確に分けることを推奨。マークダウンで記述されたプロンプトを非常にうまく解釈できる

**Google (Gemini シリーズ)**

こちらも特定の形式を強制してはいませんが、マークダウン形式で構造化されたプロンプトを問題なく理解。プロンプト設計のベストプラクティスとして、「明確で具体的な指示を与えること」や「役割（ペルソナ）を与えること」などが挙げられており、これらの要素をマークダウンの見出しで整理するのは有効

---

## 3-4-1. プロンプト形式の選択：マークアップ vs マークダウン（続き 6）

#### まとめと使い分けの指針

| 目的・状況                     | 推奨される形式 | 理由                                                                            |
| ------------------------------ | -------------- | ------------------------------------------------------------------------------- |
| 手軽に試したい、一般的なタスク | マークダウン   | 読み書きしやすく、ほとんどのモデルで十分機能するため                            |
| プロンプトの構造が複雑         | マークアップ   | 各要素の役割を厳密に定義でき、モデルの誤解釈を防げるため                        |
| 複数の文書やデータを入力する   | マークアップ   | `<doc1>`, `<doc2>` のように明確に区別できるため                                 |
| 使用モデルが Claude            | マークアップ   | 公式に推奨されており、パフォーマンス向上が期待できるため                        |
| 使用モデルが GPT や Gemini     | マークダウン   | 一般的で十分な性能を発揮する。複雑な場合は区切り文字(`###`など)を併用すると良い |

**最終的な指針**

**「どちらの形式を使えば、自分のタスクで最も良い結果が得られるか」**を試行錯誤必要（めんどいが）。まずは手軽なマークダウンから始め、より複雑な制御が必要になった場合にマークアップを試してみるのがよさそう

---

## 3-5. コンテキストエンジニアリングの高度な活用

#### マルチモーダルコンテキスト

**複数情報源の統合**

- **テキスト情報**: 特許文献、技術資料
- **図面情報**: 発明の図面、フローチャート
- **数値データ**: 実験データ、統計情報
- **音声情報**: 会議録音、インタビュー

---

## 3-5. コンテキストエンジニアリングの高度な活用（続き 1）

#### マルチモーダルコンテキスト（続き）

**統合的な分析**

```

1. 情報の収集・整理
2. 関連性の分析
3. 統合的な評価
4. 総合的な提案

```

#### 動的コンテキスト管理

**リアルタイム調整**

- **状況変化への対応**: 新しい情報の追加
- **優先度の動的変更**: 重要度の変化への対応
- **専門性の調整**: 技術分野の変更への対応
- **制約条件の更新**: 新しい制約への対応

---

## 3-5. コンテキストエンジニアリングの高度な活用（続き 2）

#### 協調的コンテキスト設計

**チームでの活用**

- **役割分担**: 各メンバーの専門性を活かした設計
- **情報共有**: チーム内での情報共有と活用
- **統一基準**: チーム全体での統一された基準
- **継続改善**: チーム全体での継続的な改善

---

## 3-5. コンテキストエンジニアリングの高度な活用（続き 3）

#### 協調的コンテキスト設計（続き）

**組織的な活用**

- **標準化**: 組織全体での標準的な設計
- **ベストプラクティス**: 成功事例の組織内共有
- **トレーニング**: コンテキスト設計スキルの向上
- **評価・改善**: 組織全体での効果測定と改善

---

## 3-5. コンテキストエンジニアリングの高度な活用（続き 4）

#### 高度なテクニック

**自動化と最適化**

- **自動調整**: 状況に応じた自動的な調整
- **学習機能**: 使用履歴からの学習と最適化
- **予測機能**: 次に必要な情報の予測
- **提案機能**: 最適なコンテキストの提案

---

## 3-6. コンテキストエンジニアリングの効果測定

#### 測定指標の設定

**定量的指標**

- **回答精度**: 期待する回答との一致度
- **処理時間**: 回答生成にかかる時間
- **一貫性**: 複数回の実行での一貫性
- **効率性**: 情報収集・処理の効率

---

## 3-6. コンテキストエンジニアリングの効果測定（続き 1）

#### 測定指標の設定（続き）

**定性的指標**

- **満足度**: ユーザーの満足度
- **実用性**: 実際の業務での使用可能性
- **創造性**: 新たな視点や洞察の提供
- **適切性**: 状況に適した回答の提供

---

## 3-6. コンテキストエンジニアリングの効果測定（続き 2）

#### 効果測定の方法

**測定プロセス**

1. **ベースライン設定**: 現在の性能を測定
2. **目標設定**: 改善すべき指標と目標値を設定
3. **改善実施**: コンテキスト設計の改善
4. **効果測定**: 改善効果を測定・評価
5. **継続改善**: さらなる改善を実施

---

## 3-6. コンテキストエンジニアリングの効果測定（続き 3）

#### 継続的改善サイクル

**PDCA サイクルの活用**

- **Plan（計画）**: 改善計画の策定
- **Do（実行）**: 改善の実施
- **Check（確認）**: 効果の測定・評価
- **Act（改善）**: さらなる改善の実施

---

## 3-7. コンテキスト設計例

#### 特許調査プロジェクトの完全例

**プロジェクト概要**

<role>
あなたは特許調査プロジェクトのリーダーで、15年の実務経験があります。
AI技術分野での調査に精通し、効率的で網羅的な調査を専門としています。
</role>

<context>
AI技術分野の新規発明について、先行技術調査を実施する必要があります。
調査結果は特許出願の判断材料として使用されます。
</context>

---

## 3-7. コンテキスト設計例（続き 1）

#### 特許調査プロジェクトの完全例（続き）

<environment>
利用可能なリソース：
- 特許データベース（J-PlatPat、USPTO、EPO）
- 技術文献データベース
- 分析ツール（Excel、Python、Tableau）
- 専門家チーム（技術者、弁理士）
</environment>

<conversation_style>
専門的かつ実用的な分析を提供し、具体的な根拠を示してください。
技術的詳細と法的観点の両方を考慮した回答をお願いします。
</conversation_style>

---

## 3-7. コンテキスト設計例（続き 2）

#### 特許調査プロジェクトの完全例（続き 2）

<expertise>
- 特許法の深い理解
- AI技術の専門知識
- 検索戦略の設計
- 分析手法の選択
- プロジェクト管理
</expertise>

<quality_standards>

- 網羅性：関連文献の見落としを最小化
- 精度：技術的・法的に正確な分析
- 効率性：最短時間での調査完了
- 実用性：実際の判断に使用可能
  </quality_standards>

---

## 3-7. コンテキスト設計例（続き 3）

#### 調査プロセスの設計

**段階的な調査プロセス**

1. **事前準備フェーズ**

   - 発明の詳細理解
   - 調査範囲の設定
   - 検索戦略の策定

2. **検索実行フェーズ**
   - キーワード検索
   - 分類検索
   - 引用検索

---

## 3-7. コンテキスト設計例（続き 4）

#### 調査プロセスの設計（続き）

3. **分析評価フェーズ**

   - 関連性評価
   - 新規性・進歩性評価
   - リスク評価

4. **報告書作成フェーズ**
   - 調査結果の整理
   - 分析結果のまとめ
   - 推奨事項の提示

#### 継続的な改善

**改善サイクル**

- **定期的な評価**: 月次での効果測定
- **フィードバック収集**: ユーザーからの意見収集
- **改善実施**: 効果的な改善の実施
- **ベストプラクティス化**: 成功パターンの標準化

---

## 3-8. コンテキストエンジニアリングのベストプラクティス

#### 設計時の注意点

**基本原則**

- **明確性**: 曖昧さを排除した明確な設計
- **一貫性**: 全体を通じて一貫した設計
- **実用性**: 実際の業務で使いやすい設計
- **拡張性**: 将来の拡張に対応できる設計

---

## 3-8. コンテキストエンジニアリングのベストプラクティス（続き 1）

#### 将来展望

**技術的発展**

- **AI 技術の進歩**: より高度なコンテキスト理解
- **自動化の向上**: 自動的なコンテキスト調整
- **統合化の進展**: 複数システムとの統合
- **パーソナライゼーション**: 個別最適化の実現

---

## 3-8. コンテキストエンジニアリングのベストプラクティス（続き 2）

#### 将来展望（続き）

**組織的発展**

- **標準化の進展**: 業界標準の確立
- **専門性の向上**: 専門家の育成
- **組織文化の変化**: AI 活用文化の定着
- **競争優位性**: 他社との差別化

#### アドバイス

**導入時のポイント**

- **段階的な導入**: 小さな範囲から開始
- **効果測定**: 定量的な効果測定の実施
- **ユーザー教育**: 適切な使用方法の教育
- **継続的改善**: 継続的な改善の実施

---

## 3-8. コンテキストエンジニアリングのベストプラクティス（続き 3）

#### アドバイス（続き）

**成功の鍵**

- **明確な目的**: 何を達成したいかを明確にする
- **適切な設計**: 目的に適した設計の実施
- **継続的な改善**: 継続的な改善の実施
- **組織的な支援**: 組織全体での支援体制

---

## 3-9. コンテキストエンジニアリング周辺の知識

#### RAG(Retrieval Augmented Generation)

**RAG の基本概念**

- **情報検索**: 関連文書の自動検索
- **文脈生成**: 検索結果を基にした回答生成
- **精度向上**: 最新情報の活用による精度向上
- **信頼性向上**: 根拠のある回答の提供

**知財業務での活用**

- **特許文献検索**: 関連特許の自動検索
- **技術動向分析**: 最新技術情報の分析
- **先行技術調査**: 効率的な先行技術調査
- **レポート生成**: 自動レポート生成

#### Agent

**Agent の基本概念**

- **自律性**: 独立した意思決定と実行
- **目標指向**: 特定の目標に向けた行動
- **学習能力**: 経験からの学習と改善
- **適応性**: 環境変化への適応

**知財業務での活用**

- **自動調査**: 特許調査の自動実行
- **監視システム**: 新規特許の自動監視
- **分析エージェント**: 技術分析の自動実行
- **レポートエージェント**: 定期レポートの自動生成

#### Tool

**Tool の基本概念**

- **機能特化**: 特定の機能に特化したツール
- **連携性**: 他のシステムとの連携
- **拡張性**: 新機能の追加が容易
- **再利用性**: 複数の場面での再利用

**知財業務での活用**

- **データ処理ツール**: 特許データの処理
- **分析ツール**: 技術分析の実行
- **可視化ツール**: 分析結果の可視化
- **レポートツール**: レポートの自動生成

#### Model

**Model の基本概念**

- **言語モデル**: 自然言語処理の基盤
- **多様性**: 様々な用途に対応
- **カスタマイズ**: 特定用途への最適化
- **進歩性**: 継続的な性能向上

**知財業務での活用**

- **GPT-4**: 高度な自然言語処理
- **Claude**: 論理的思考と安全性
- **Gemini**: マルチモーダル処理
- **専門モデル**: 特許分野特化モデル

#### Context/Memory/Session

**Context の基本概念**

- **文脈管理**: 対話の文脈を保持
- **記憶機能**: 過去のやり取りを記憶
- **セッション管理**: 対話セッションの管理
- **状態管理**: システムの状態を管理

**知財業務での活用**

- **調査履歴**: 過去の調査結果の活用
- **分析履歴**: 分析プロセスの記録
- **学習履歴**: システムの学習履歴
- **改善履歴**: 継続的改善の記録

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）

#### POML の基本概念

**POML とは**

```
プロンプトの「設計書」
プロンプトオーケストレーションマークアップ言語（POML）は、
大規模言語モデル（LLM）のプロンプト設計と管理を体系化するための
新しいマークアップ言語。Microsoftが提唱中
```

[参考](https://github.com/microsoft/poml)

**主な特徴**

- **構造化されたプロンプト設計**: HTML に似たタグ構造を採用
- **多様なデータ統合**: テキスト、表、画像などの外部データを統合
- **プレゼンテーションの分離**: 内容と表示形式の分離
- **動的なプロンプト生成**: テンプレートエンジンによる動的生成

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）（続き）

#### POML の利点

**システムプロンプトの管理効率化**

- **構造化**: プロンプトをモジュール化して管理
- **再利用性**: 共通部分の再利用による効率化
- **保守性**: 変更や更新が容易
- **一貫性**: 統一されたプロンプトスタイルの維持

**動的なプロンプト生成の容易化**

- **テンプレート機能**: 変数、ループ、条件分岐のサポート
- **状況適応**: ユーザー入力や状況に応じた動的生成
- **多様性対応**: 様々なタスクやコンテキストへの適応
- **自動化**: プロンプト生成の自動化

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）（続き 2）

#### POML の基本構造

**基本タグ構造**

```xml
<poml>
  <role>AIの役割定義</role>
  <task>実行すべきタスク</task>
  <format>出力形式の指定</format>
  <input>入力データ</input>
  <constraints>制約条件</constraints>
</poml>
```

**特許業務での活用例**

```xml
<poml>
  <role>あなたは特許調査の専門家です</role>
  <task>以下の技術分野で先行技術調査を実施してください</task>
  <format>構造化された調査レポート</format>
  <input>
    技術分野：AI技術
    調査期間：2020年以降
    調査地域：日本、米国、欧州
  </input>
  <constraints>網羅性と効率性の両立</constraints>
</poml>
```

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）（続き 3）

#### 複雑な AI エージェントでの活用

**システムプロンプト管理**:いつ誰がどんなふうに書いた（編集した）か、をきちんと管理していく

- **モジュール化**: 機能別にプロンプトを分割
- **階層構造**: 親子関係による構造化
- **依存関係管理**: モジュール間の依存関係の管理
- **バージョン管理**: プロンプトの変更履歴管理

**動的プロンプト生成**

- **コンテキスト適応**: 状況に応じたプロンプト調整
- **ユーザーカスタマイズ**: 個人の好みやスキルに応じた調整
- **リアルタイム更新**: 最新情報の反映
- **条件分岐**: 状況に応じた分岐処理

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）（続き 4）

#### 知財業務での実践例

**特許調査エージェントの設計**

```xml
<poml>
  <role>
    <expertise>特許調査専門家</expertise>
    <experience>15年の実務経験</experience>
    <specialization>AI技術分野</specialization>
  </role>

  <workflow>
    <step1>技術理解とキーワード抽出</step1>
    <step2>検索式設計と実行</step2>
    <step3>関連性評価と分析</step3>
    <step4>レポート作成</step4>
  </workflow>

  <tools>
    <database>特許データベース</database>
    <analysis>分析ツール</analysis>
    <visualization>可視化ツール</visualization>
  </tools>
</poml>
```

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）（続き 5）

#### 開発ツールとエコシステム

**開発環境**

- **Visual Studio Code 拡張**: POML 専用の開発環境
- **Node.js SDK**: JavaScript/TypeScript での開発
- **Python SDK**: Python での開発
- **統合開発環境**: 既存ワークフローとの統合

**品質管理**

- **構文チェック**: POML 構文の自動検証
- **セマンティック検証**: 意味的な整合性の確認
- **パフォーマンス測定**: プロンプトの効果測定
- **A/B テスト**: 異なるプロンプトの比較評価

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）（続き 6）

#### 導入と運用のベストプラクティス

**段階的導入**

1. **基本構造の設計**: 基本的な POML 構造の定義
2. **モジュール化**: 機能別のモジュール分割
3. **テンプレート作成**: 再利用可能なテンプレートの作成
4. **統合とテスト**: システムへの統合とテスト

**継続的改善**

- **効果測定**: 定期的な効果評価
- **フィードバック収集**: ユーザーからの意見収集
- **最適化**: パフォーマンスの最適化
- **拡張**: 新機能の追加

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）（続き 7）

#### テンプレートエンジン機能

**ループ機能**

`for` 属性を使用してループを定義できます。`for item in items` の形式で記述します。

**基本的なループ例**

```xml
<poml>
  <output-format>
    以下のような鳴き声で返答してください。
    <list for="cry in ['ニャー', 'アオーン', 'シャー!']">
      <item>{{cry}}</item>
    </list>
  </output-format>
</poml>
```

**出力結果**

```markdown
# Output Format

以下のような鳴き声で返答してください。

- ニャー
- アオーン
- シャー!
```

---

**ループ変数の活用**

ループの中では特別な変数 `loop` が定義され、ループの状態を参照できます。

- `loop.index`: 現在のループのインデックス（0 から始まる）
- `loop.length`: ループのアイテム数
- `loop.first`: 最初のアイテムかどうか（boolean）
- `loop.last`: 最後のアイテムかどうか（boolean）

**複雑なループ例**

```xml
<poml>
  <let name="examples" value='[
    { "input": "あなたの名前はなんですか？", "output": "私の名前はAIです。" },
    { "input": "好きな食べ物は何ですか？", "output": "私はデータが好きです。" },
    { "input": "趣味は何ですか？", "output": "私は学習することが趣味です。" }
  ]' />

  <examples>
    <example for="example in examples" chat="false" caption="Example {{ loop.index + 1 }}" captionStyle="header">
      <input>{{ example.input }}</input>
      <output>{{ example.output }}</output>
    </example>
  </examples>
</poml>
```

---

**出力結果**

```markdown
# Examples

## Example 1

**Input:** あなたの名前はなんですか？

**Output:** 私の名前は AI です。

## Example 2

**Input:** 好きな食べ物は何ですか？

**Output:** 私はデータが好きです。

## Example 3

**Input:** 趣味は何ですか？

**Output:** 私は学習することが趣味です。
```

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）（続き 8）

#### 条件分岐機能

**if 属性による条件分岐**

`if` 属性を使用して条件分岐を定義できます。`if` 属性には JavaScript の式を指定し、条件が真の場合にそのブロックが実行されます。

**条件分岐の例**

```xml
<poml>
  <let name="settings" value='{
    "isPlanMode": true
  }' />

  <task>
    あなたはコーディングエージェントです。以下の条件に従って行動してください。

    <list>
      <item if="settings.isPlanMode">コードの読み書きは行わずに、計画を立てることに専念してください。</item>
      <item if="!settings.isPlanMode">ユーザーからの指示に従ってコードを生成してください。</item>
    </list>
  </task>
</poml>
```

---

**出力結果**

```markdown
# Task

あなたはコーディングエージェントです。以下の条件に従って行動してください。

- コードの読み書きは行わずに、計画を立てることに専念してください。
```

**知財業務での活用例**

```xml
<poml>
  <let name="taskType" value="'patent_search'" />
  <let name="complexity" value="'high'" />

  <role>
    あなたは特許調査の専門家です。
  </role>

  <task>
    <item if="taskType === 'patent_search'">特許文献の検索と分析を実施してください。</item>
    <item if="taskType === 'prior_art'">先行技術調査を実施してください。</item>
    <item if="taskType === 'infringement'">侵害調査を実施してください。</item>
  </task>

  <approach>
    <item if="complexity === 'high'">詳細な分析と包括的なレポートを作成してください。</item>
    <item if="complexity === 'medium'">標準的な分析とサマリーレポートを作成してください。</item>
    <item if="complexity === 'low'">簡潔な分析と要点レポートを作成してください。</item>
  </approach>
</poml>
```

---

## 3-10. プロンプトオーケストレーションマークアップ言語（POML）（続き 9）

#### 将来展望と課題

**技術的発展**

- **AI 技術との統合**: より高度な AI 技術との統合
- **自動化の向上**: プロンプト生成の自動化
- **標準化の進展**: 業界標準の確立
- **エコシステムの拡大**: 開発ツールの充実

**組織的課題**

- **スキル開発**: POML スキルの習得
- **組織文化**: AI 活用文化の定着
- **投資判断**: 導入コストと効果の評価
- **競争優位性**: 他社との差別化

**参考資料**

- [LLM へのプロンプトを構造化された文書で管理する POML](https://azukiazusa.dev/blog/poml-prompt-structured-document/) - azukiazusa.dev

---

## 3-11. AI エージェントの設計と実装における基盤技術要素

#### AI エージェントの認知アーキテクチャ

**基盤となる技術要素と連携**

AI エージェントは、モデル、ツール、オーケストレーション層という 3 つの不可欠な構成要素から成り立っている。
これらの要素を「コンテキストエンジニアリング」の手法を用いて管理する

---

## 3-11. AI エージェントの設計と実装における基盤技術要素（続き 1）

#### 1. モデル (LLM) - 中核的な意思決定者

**大規模言語モデル（LLM）の役割**

- **予測エンジン**: 訓練データに基づいて次に来るべきトークンを予測するプロセスを繰り返し実行
- **推論・論理フレームワーク**: ReAct、Chain-of-Thought（CoT）、Tree-of-Thoughts（ToT）などの手法に対応
- **モデルタイプ**: 汎用目的、マルチモーダル、ファインチューニングされたモデル

**モデルとエージェントの違い**

| 項目           | モデル                                      | エージェント                                              |
| -------------- | ------------------------------------------- | --------------------------------------------------------- |
| **知識範囲**   | 訓練データ内の知識に限定                    | ツールを介した外部システムとの接続で知識を拡張            |
| **推論能力**   | ユーザーの問い合わせに基づく単一の推論/予測 | 管理されたセッション履歴により複数ターンの推論/予測が可能 |
| **ツール実装** | ネイティブなツールの実装は通常なし          | ツールがエージェントアーキテクチャにネイティブに実装      |

---

## 3-11. AI エージェントの設計と実装における基盤技術要素（続き 2）

#### 2. ツール - 外部世界との接続

**ツールの役割と重要性**

ツールは、基盤モデルが外部世界とやり取りできないという制約を埋め、エージェントが外部データやサービスと対話できるようにします。これにより、基盤となるモデル単独の能力を超える広範なアクションが可能になります。

**主要なツールタイプ**

**拡張機能（Extensions）**

- API とエージェント間のギャップを標準化された方法で埋める
- エージェントサイドで実行
- API 呼び出しの制御を開発者がエージェントに委任

**Function**

- モデルは Function とその引数を出力
- 実際の API 呼び出しのロジックと実行はクライアントサイドのアプリケーションにオフロード
- 開発者がアプリケーション内のデータフローに対して、よりきめ細かい制御を実現

---

## 3-11. AI エージェントの設計と実装における基盤技術要素（続き 3）

#### 2. ツール - 外部世界との接続（続き）

**データストア（Datastores）**

- モデルが訓練データを超える、より動的で最新の情報にアクセス可能
- モデルの応答が事実に基づいたものになることを保証
- 通常、ベクトルデータベースとして実装
- 検索拡張生成（RAG）ベースのアプリケーションで活用

**知財業務での活用例**

- **特許データベース連携**: 最新の特許情報へのアクセス
- **技術文献検索**: 学術論文や技術レポートの検索
- **市場データ分析**: 競合他社の技術動向分析
- **法規制情報**: 知的財産関連の法規制情報の取得

---

## 3-11. AI エージェントの設計と実装における基盤技術要素（続き 4）

#### 3. オーケストレーション層 - 情報管理と推論プロセス

**オーケストレーション層の役割**

オーケストレーション層は、エージェントが情報を取り込み、内部推論を実行し、その推論を次の行動や意思決定の判断材料とする方法を規定する、周期的なプロセスを記述します。

**主要な機能**

- **記憶の維持**: 過去の対話や行動の記録
- **状態管理**: エージェントの現在の状態の管理
- **推論実行**: 論理的思考プロセスの実行
- **計画立案**: 目標達成のための計画策定

**プロセスフロー**

1. 情報の取り込み
2. 内部推論の実行
3. 推論結果の評価
4. 次の行動の決定
5. 目標または停止点に到達するまで継続

---

## 3-11. AI エージェントの設計と実装における基盤技術要素（続き 5）

#### オーケストレーション層における主要なプロンプトエンジニアリングフレームワーク

**ReAct (Reason and Act)**

- **思考・行動ループ**: LLM が自然言語による推論と外部ツールを組み合わせ
- **複雑なタスク解決**: 検索、コードインタプリタなどを活用した問題解決
- **人間の模倣**: 人間が実世界で活動する方法を模倣したアプローチ

**Chain-of-Thought (CoT)**

- **中間推論ステップ**: LLM に中間の推論ステップを生成させる
- **推論能力向上**: より正確な回答を生成しやすくする
- **透明性**: 思考プロセスの可視化

**Tree of Thoughts (ToT)**

- **複数推論パス**: 単一の直線的な思考の連鎖だけでなく、複数の異なる推論パスを同時に探索
- **CoT の一般化**: CoT プロンプティングの概念を一般化
- **最適解探索**: より良い解決策の発見

---

## 3-11. AI エージェントの設計と実装における基盤技術要素（続き 6）

#### 技術要素の連携による全体像

**認知アーキテクチャの中核**

AI エージェントの認知アーキテクチャの中核にあるのは、モデル、ツール、そしてオーケストレーション層の連携です。

**連携プロセス**

1. **ユーザー問い合わせ**: ユーザーがエージェントに問い合わせを送信
2. **推論フレームワーク開始**: オーケストレーション層が ReAct のような推論フレームワークを開始
3. **ステップ生成**: モデルに次のステップ（思考、行動、行動入力、観察）を生成
4. **ツール実行**: モデルが必要に応じてツールを選択・実行
5. **コンテキスト更新**: 結果（観察）をコンテキストに追加
6. **継続的実行**: エージェントが問題の解決策に到達するまで繰り返し

**知財業務での実践例**

- **特許調査エージェント**: 技術キーワード抽出 → 検索実行 → 関連性評価 → レポート生成
- **競合分析エージェント**: 競合他社特定 → 技術動向分析 → リスク評価 → 戦略提案

---

## 3-12. コンテキストエンジニアリングの役割と戦略

#### コンテキストエンジニアリングの重要性

**LLM の能力を最大限に引き出す技術**

これらの要素が効果的に機能するためには、LLM のコンテキストウィンドウを「適切な情報で満たす」技術と科学であるコンテキストエンジニアリングが不可欠です。

**プロンプトエンジニアリングとの違い**

- **より広範な概念**: プロンプトエンジニアリングよりも広範な概念
- **事前活動の包含**: プロンプトが作成される前の活動も含む
- **設計全体のカバー**: LLM の能力を最大限に引き出すための設計全体をカバー
- **最重要スキル**: エージェントのビルドにおいて最も重要なスキルの 1 つ

---

## 3-12. コンテキストエンジニアリングの役割と戦略（続き 1）

#### コンテキストエンジニアリングの主要な戦略

**1. Write Context (コンテキストを書き出す)**

- **外部情報保存**: エージェントがタスクを実行するのを助けるために、コンテキストウィンドウの外に情報を保存
- **スクラッチパッド**: メモ取り機能の活用
- **ランタイム状態オブジェクト**: エージェントのランタイム状態オブジェクトへの情報の保存

**知財業務での活用例**

- **調査メモ**: 特許調査の過程での発見事項の記録
- **分析履歴**: 技術分析の過程での判断根拠の保存
- **学習データ**: 過去の事例からの学習データの蓄積

---

## 3-12. コンテキストエンジニアリングの役割と戦略（続き 2）

#### コンテキストエンジニアリングの主要な戦略（続き）

**2. Select Context (コンテキストを選択する)**

- **関連情報の動的取得**: タスクに関連する情報だけをコンテキストウィンドウに引き込み
- **メモリの活用**: フューショット事例、指示、事実などの関連メモリ
- **ツールと知識の統合**: RAG を含む知識ベースの動的取得・選択

**知財業務での活用例**

- **関連特許の選択**: 調査対象技術に関連する特許文献の動的選択
- **技術動向の抽出**: 最新の技術動向情報の選択的取得
- **法規制情報の取得**: 関連する法規制情報の動的取得

---

## 3-12. コンテキストエンジニアリングの役割と戦略（続き 3）

#### コンテキストエンジニアリングの主要な戦略（続き）

**3. Compressing Context (コンテキストを圧縮する)**

- **トークン消費削減**: タスクの実行に必要なトークンのみを保持
- **要約手法**: 長い文書や対話履歴の要約
- **トリミング**: 不要な情報の除去

**知財業務での活用例**

- **特許文献の要約**: 長い特許明細書の要点抽出
- **調査結果の圧縮**: 大量の調査結果の要約
- **対話履歴の整理**: 過去の対話の重要な部分のみを保持

**4. Isolating Context (コンテキストを分離する)**

- **コンテキスト分割**: エージェントのタスク実行を助けるためにコンテキストを分割
- **サブエージェント活用**: 複数のサブエージェントにコンテキストを分割
- **サンドボックス環境**: 状態オブジェクトを使用して LLM からトークン量の多いオブジェクトを隔離

---

## 3-12. コンテキストエンジニアリングの役割と戦略（続き 4）

#### 知財業務での活用

**特許調査エージェントの設計例**

```
Write Context:
- 調査履歴の外部保存
- 技術キーワードの記録
- 関連企業情報の蓄積

Select Context:
- 関連特許文献の動的取得
- 技術動向情報の選択
- 競合他社情報の取得

Compress Context:
- 特許明細書の要約
- 調査結果の要点抽出
- 対話履歴の整理

Isolate Context:
- 技術分野別のサブエージェント
- 調査段階別のコンテキスト分離
- 機密情報の隔離
```

---

## 3-12. コンテキストエンジニアリングの役割と戦略（続き 5）

#### 効果的な AI エージェントの実現

**実現される能力**

- **複雑なタスクの自律実行**: 人間の介入なしでの複雑な業務の実行
- **効率的な情報処理**: 大量の情報の効率的な処理と分析
- **正確な判断**: 文脈を考慮した正確な判断と推論
- **継続的学習**: 経験からの学習と改善

**知財業務での期待効果**

- **調査効率の大幅向上**: 自動化による調査時間の短縮
- **分析精度の向上**: 文脈を考慮した高精度な分析
- **コスト削減**: 人的リソースの効率的活用
- **競争優位性**: 迅速で正確な知財戦略の実現

```

```
